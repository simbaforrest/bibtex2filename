bibtex2filenamePatternParser=(function(){function quote(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var result={parse:function(input,startRule){var parseFunctions={pattern:parse_pattern,gppat:parse_gppat,orpat:parse_orpat,andpat:parse_andpat,element:parse_element,"var":parse_var,fix:parse_fix};if(startRule!==undefined){if(parseFunctions[startRule]===undefined){throw new Error("Invalid rule name: "+quote(startRule)+".")}}else{startRule="pattern"}var pos={offset:0,line:1,column:1,seenCR:false};var reportFailures=0;var rightmostFailuresPos={offset:0,line:1,column:1,seenCR:false};var rightmostFailuresExpected=[];function padLeft(input,padding,length){var result=input;var padLength=length-input.length;for(var i=0;i<padLength;i++){result=padding+result}return result}function escape(ch){var charCode=ch.charCodeAt(0);var escapeChar;var length;if(charCode<=255){escapeChar="x";length=2}else{escapeChar="u";length=4}return"\\"+escapeChar+padLeft(charCode.toString(16).toUpperCase(),"0",length)}function clone(object){var result={};for(var key in object){result[key]=object[key]}return result}function advance(pos,n){var endOffset=pos.offset+n;for(var offset=pos.offset;offset<endOffset;offset++){var ch=input.charAt(offset);if(ch==="\n"){if(!pos.seenCR){pos.line++}pos.column=1;pos.seenCR=false}else{if(ch==="\r"||ch==="\u2028"||ch==="\u2029"){pos.line++;pos.column=1;pos.seenCR=true}else{pos.column++;pos.seenCR=false}}}pos.offset+=n}function matchFailed(failure){if(pos.offset<rightmostFailuresPos.offset){return}if(pos.offset>rightmostFailuresPos.offset){rightmostFailuresPos=clone(pos);rightmostFailuresExpected=[]}rightmostFailuresExpected.push(failure)}function parse_pattern(){var result0,result1;var pos0,pos1;pos0=clone(pos);pos1=clone(pos);result0=parse_element();if(result0!==null){result1=parse_pattern();result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,E,R){return E+R})(pos0.offset,pos0.line,pos0.column,result0[0],result0[1])}if(result0===null){pos=clone(pos0)}if(result0===null){pos0=clone(pos);pos1=clone(pos);result0=parse_fix();if(result0!==null){result1=parse_pattern();result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,F,R){return F+R})(pos0.offset,pos0.line,pos0.column,result0[0],result0[1])}if(result0===null){pos=clone(pos0)}if(result0===null){result0=parse_gppat();if(result0===null){result0=parse_orpat();if(result0===null){result0=parse_andpat()}}}}return result0}function parse_gppat(){var result0,result1,result2,result3,result4;var pos0,pos1;reportFailures++;pos0=clone(pos);pos1=clone(pos);if(input.charCodeAt(pos.offset)===91){result0="[";advance(pos,1)}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0!==null){result1=parse_pattern();if(result1!==null){if(input.charCodeAt(pos.offset)===93){result2="]";advance(pos,1)}else{result2=null;if(reportFailures===0){matchFailed('"]"')}}if(result2!==null){result3=[];result4=parse_pattern();while(result4!==null){result3.push(result4);result4=parse_pattern()}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,P,R){return P+R})(pos0.offset,pos0.line,pos0.column,result0[1],result0[3])}if(result0===null){pos=clone(pos0)}reportFailures--;if(reportFailures===0&&result0===null){matchFailed("group-pattern [P]")}return result0}function parse_orpat(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;reportFailures++;pos0=clone(pos);pos1=clone(pos);if(input.charCodeAt(pos.offset)===91){result0="[";advance(pos,1)}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0!==null){result1=parse_pattern();if(result1!==null){if(input.charCodeAt(pos.offset)===124){result2="|";advance(pos,1)}else{result2=null;if(reportFailures===0){matchFailed('"|"')}}if(result2!==null){result3=parse_pattern();if(result3!==null){if(input.charCodeAt(pos.offset)===93){result4="]";advance(pos,1)}else{result4=null;if(reportFailures===0){matchFailed('"]"')}}if(result4!==null){result5=[];result6=parse_pattern();while(result6!==null){result5.push(result6);result6=parse_pattern()}if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,P1,P2,R){if(P1!=""){return P1+R}else{return P2+R}})(pos0.offset,pos0.line,pos0.column,result0[1],result0[3],result0[5])}if(result0===null){pos=clone(pos0)}reportFailures--;if(reportFailures===0&&result0===null){matchFailed("or-pattern [P1|P2]")}return result0}function parse_andpat(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;reportFailures++;pos0=clone(pos);pos1=clone(pos);if(input.charCodeAt(pos.offset)===91){result0="[";advance(pos,1)}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0!==null){result1=parse_pattern();if(result1!==null){if(input.charCodeAt(pos.offset)===38){result2="&";advance(pos,1)}else{result2=null;if(reportFailures===0){matchFailed('"&"')}}if(result2!==null){result3=parse_pattern();if(result3!==null){if(input.charCodeAt(pos.offset)===93){result4="]";advance(pos,1)}else{result4=null;if(reportFailures===0){matchFailed('"]"')}}if(result4!==null){result5=[];result6=parse_pattern();while(result6!==null){result5.push(result6);result6=parse_pattern()}if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,P1,P2,R){if(P1!=""&&P2!=""){return P1+P2+R}else{return""+R}})(pos0.offset,pos0.line,pos0.column,result0[1],result0[3],result0[5])}if(result0===null){pos=clone(pos0)}reportFailures--;if(reportFailures===0&&result0===null){matchFailed("and-pattern [P1&P2]")}return result0}function parse_element(){var result0,result1,result2;var pos0,pos1;reportFailures++;pos0=clone(pos);pos1=clone(pos);result0=parse_fix();result0=result0!==null?result0:"";if(result0!==null){result1=parse_var();if(result1!==null){result2=parse_fix();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,Pre,Var,Post){if(Var!=""){return Pre+Var+Post}return""})(pos0.offset,pos0.line,pos0.column,result0[0],result0[1],result0[2])}if(result0===null){pos=clone(pos0)}reportFailures--;if(reportFailures===0&&result0===null){matchFailed("prefix-var-postfix")}return result0}function parse_var(){var result0,result1,result2;var pos0,pos1;pos0=clone(pos);if(input.substr(pos.offset,2)==="$$"){result0="$$";advance(pos,2)}else{result0=null;if(reportFailures===0){matchFailed('"$$"')}}if(result0!==null){result0=(function(offset,line,column){return"$"})(pos0.offset,pos0.line,pos0.column)}if(result0===null){pos=clone(pos0)}if(result0===null){pos0=clone(pos);if(input.substr(pos.offset,2)==="$|"){result0="$|";advance(pos,2)}else{result0=null;if(reportFailures===0){matchFailed('"$|"')}}if(result0!==null){result0=(function(offset,line,column){return"|"})(pos0.offset,pos0.line,pos0.column)}if(result0===null){pos=clone(pos0)}if(result0===null){pos0=clone(pos);if(input.substr(pos.offset,2)==="$&"){result0="$&";advance(pos,2)}else{result0=null;if(reportFailures===0){matchFailed('"$&"')}}if(result0!==null){result0=(function(offset,line,column){return"&"})(pos0.offset,pos0.line,pos0.column)}if(result0===null){pos=clone(pos0)}if(result0===null){pos0=clone(pos);if(input.substr(pos.offset,2)==="$["){result0="$[";advance(pos,2)}else{result0=null;if(reportFailures===0){matchFailed('"$["')}}if(result0!==null){result0=(function(offset,line,column){return"["})(pos0.offset,pos0.line,pos0.column)}if(result0===null){pos=clone(pos0)}if(result0===null){pos0=clone(pos);if(input.substr(pos.offset,2)==="$]"){result0="$]";advance(pos,2)}else{result0=null;if(reportFailures===0){matchFailed('"$]"')}}if(result0!==null){result0=(function(offset,line,column){return"]"})(pos0.offset,pos0.line,pos0.column)}if(result0===null){pos=clone(pos0)}if(result0===null){pos0=clone(pos);pos1=clone(pos);if(input.charCodeAt(pos.offset)===36){result0="$";advance(pos,1)}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0!==null){if(/^[A-Za-z0-9]/.test(input.charAt(pos.offset))){result2=input.charAt(pos.offset);advance(pos,1)}else{result2=null;if(reportFailures===0){matchFailed("[A-Za-z0-9]")}}if(result2!==null){result1=[];while(result2!==null){result1.push(result2);if(/^[A-Za-z0-9]/.test(input.charAt(pos.offset))){result2=input.charAt(pos.offset);advance(pos,1)}else{result2=null;if(reportFailures===0){matchFailed("[A-Za-z0-9]")}}}}else{result1=null}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=clone(pos1)}}else{result0=null;pos=clone(pos1)}if(result0!==null){result0=(function(offset,line,column,V){return getBibTex2FileNameVar(V.join(""))})(pos0.offset,pos0.line,pos0.column,result0[1])}if(result0===null){pos=clone(pos0)}}}}}}return result0}function parse_fix(){var result0,result1;var pos0;pos0=clone(pos);if(/^[^$[\]|&]/.test(input.charAt(pos.offset))){result1=input.charAt(pos.offset);advance(pos,1)}else{result1=null;if(reportFailures===0){matchFailed("[^$[\\]|&]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[^$[\]|&]/.test(input.charAt(pos.offset))){result1=input.charAt(pos.offset);advance(pos,1)}else{result1=null;if(reportFailures===0){matchFailed("[^$[\\]|&]")}}}}else{result0=null}if(result0!==null){result0=(function(offset,line,column,F){return F.join("")})(pos0.offset,pos0.line,pos0.column,result0)}if(result0===null){pos=clone(pos0)}return result0}function cleanupExpected(expected){expected.sort();var lastExpected=null;var cleanExpected=[];for(var i=0;i<expected.length;i++){if(expected[i]!==lastExpected){cleanExpected.push(expected[i]);lastExpected=expected[i]}}return cleanExpected}var result=parseFunctions[startRule]();if(result===null||pos.offset!==input.length){var offset=Math.max(pos.offset,rightmostFailuresPos.offset);var found=offset<input.length?input.charAt(offset):null;var errorPosition=pos.offset>rightmostFailuresPos.offset?pos:rightmostFailuresPos;throw new this.SyntaxError(cleanupExpected(rightmostFailuresExpected),found,offset,errorPosition.line,errorPosition.column)}return result},toSource:function(){return this._source}};result.SyntaxError=function(expected,found,offset,line,column){function buildMessage(expected,found){var expectedHumanized,foundHumanized;switch(expected.length){case 0:expectedHumanized="end of input";break;case 1:expectedHumanized=expected[0];break;default:expectedHumanized=expected.slice(0,expected.length-1).join(", ")+" or "+expected[expected.length-1]}foundHumanized=found?quote(found):"end of input";return"Expected "+expectedHumanized+" but "+foundHumanized+" found."}this.name="SyntaxError";this.expected=expected;this.found=found;this.message=buildMessage(expected,found);this.offset=offset;this.line=line;this.column=column};result.SyntaxError.prototype=Error.prototype;return result})();